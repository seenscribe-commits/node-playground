<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Reset Password - UserHub</title>
    <style>
      * { box-sizing: border-box; }
      body {
        font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
        margin: 0;
        min-height: 100vh;
        background: linear-gradient(160deg, #f0f4f8 0%, #e2e8f0 100%);
        color: #1e293b;
        padding: 2rem 1rem;
      }
      .container { max-width: 400px; margin: 0 auto; }
      .card {
        background: #fff;
        border-radius: 12px;
        padding: 1.5rem;
        box-shadow: 0 1px 3px rgba(0,0,0,0.08);
      }
      h1 { font-size: 1.5rem; margin: 0 0 1rem; color: #0f172a; }
      label { display: block; margin-bottom: 0.5rem; font-size: 0.875rem; color: #64748b; }
      input { padding: 0.5rem 0.75rem; border: 1px solid #e2e8f0; border-radius: 8px; font-size: 0.95rem; width: 100%; margin-bottom: 1rem; }
      input:focus { outline: none; border-color: #3b82f6; }
      .btn { padding: 0.5rem 1rem; border-radius: 8px; font-size: 0.95rem; border: none; cursor: pointer; background: #3b82f6; color: #fff; }
      .btn:hover { background: #2563eb; }
      .btn-secondary { background: #f1f5f9; color: #475569; }
      .btn-secondary:hover { background: #e2e8f0; }
      .message { margin-top: 1rem; padding: 0.75rem; border-radius: 8px; }
      .message.success { background: #dcfce7; color: #166534; }
      .message.error { background: #fee2e2; color: #b91c1c; }
      a { color: #3b82f6; text-decoration: none; }
      a:hover { text-decoration: underline; }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="card">
        <h1>Reset Password</h1>
        <p><a href="/">‚Üê Back to login</a></p>
        <form id="reset-form">
          <label>New password <input type="password" name="password" required minlength="6" placeholder="Min 6 characters"></label>
          <label>Confirm password <input type="password" name="confirmPassword" required minlength="6" placeholder="Confirm new password"></label>
          <button type="submit" class="btn">Reset Password</button>
        </form>
        <div id="message"></div>
      </div>
    </div>
    <script>
      const params = new URLSearchParams(window.location.search);
      const token = params.get('token');
      const form = document.getElementById('reset-form');
      const messageEl = document.getElementById('message');

      if (!token) {
        messageEl.className = 'message error';
        messageEl.textContent = 'Invalid reset link. Please request a new one.';
        form.style.display = 'none';
      } else {
        form.addEventListener('submit', function(e) {
          e.preventDefault();
          const password = this.password.value;
          const confirmPassword = this.confirmPassword.value;
          if (password !== confirmPassword) {
            messageEl.className = 'message error';
            messageEl.textContent = 'Passwords do not match';
            return;
          }
          fetch('/reset-password', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ token: token, password: password })
          })
            .then(function(r) { return r.json(); })
            .then(function(data) {
              if (data.error) {
                messageEl.className = 'message error';
                messageEl.textContent = data.error;
              } else {
                messageEl.className = 'message success';
                messageEl.textContent = data.message + ' ';
                const link = document.createElement('a');
                link.href = '/';
                link.textContent = 'Go to login';
                messageEl.appendChild(link);
                form.style.display = 'none';
              }
            })
            .catch(function() {
              messageEl.className = 'message error';
              messageEl.textContent = 'Something went wrong. Please try again.';
            });
        });
      }
    </script>
  </body>
</html>
